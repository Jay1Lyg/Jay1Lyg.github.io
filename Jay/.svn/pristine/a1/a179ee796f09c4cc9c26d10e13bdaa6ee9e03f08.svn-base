<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>dovument</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
	<style type="text/css">
		img{
			width: 100%;height: auto;
		}
		.progress-bar{
			
		}
	</style>
</head>
<body>
	<button onclick="search()">查询</button>
	<button onclick="cha()">插入</button>
	<button onclick="deleteById()">删除</button>
	<button onclick="uploadFile()">上传文件</button>
	<button onclick="downloadFile()">下载文件</button>
	
	<div class="progress-bar">
		<div class="progress">
			
		</div>
	</div>
	<div id="lesson">
		
	</div>
	
</body>
   <script src="../script/api.js" type="text/javascript" charset="utf-8"></script>
   <script type="text/javascript">
   var model,query
 	 apiready=function(){
  		 model=api.require('model')
		 query =api.require('query');
  		model.config({
	  	  appKey: 'ABDA5A27-EAC7-2F2A-CD1D-D0103502AA91',
	    	host: 'https://d.apicloud.com'
			});
		
 	 }
 	 
// 	 查询
 	 function search(){
 	 	query.createQuery(function( ret, err ){
		    if( ret ){
		         alert( JSON.stringify( ret ) ); 
		         var queryId=ret.qid
		        model.findAll({
				    class: "classes",
				    qid: queryId
				}, function( ret, err ) {
				    if( ret ){

				         alert( JSON.stringify( ret ) );   
						var _html='';
				         ret.forEach(function(item,index){
				         	_html+="<div data-id="+item.id+"><h3>课程"+item.lesson+"</h3><p>老师:"+item.teacher+"</p></div>"
				         })
				         $api.html($api.byId('lesson'),_html)
				    }else{
				         alert( JSON.stringify( err ) );
				    }
				});
		    }else{
		         alert( JSON.stringify( err ) );
		    }
		});
 	 }
// 	 插入
 	 function cha(){
		model.insert({
		    class: 'classes',
		    value: {
		         lesson : 'nnn'
		    }
		}, function(ret, err){
		    if( ret ){
		         alert( JSON.stringify( ret ) );
		    }else{
		         alert( JSON.stringify( err ) );
		    }
		});
 	 }
// 	 删除
    function deleteById(){
    	model.deleteById({
		    class: 'classes',
		    id: '58b62bc75cab771c4670f060'
		}, function(ret, err){
		    if( ret ){
		         alert( JSON.stringify( ret ) );
		    }else{
		         alert( JSON.stringify( err ) );
		    }
		});
    }
//  上传文件
    function uploadFile(){
    	model.uploadFile({
		    report: true,
		    data: {
		        file: {
		            name: '519e66585dfc6_200x200_3.png',
		            url: 'widget://image/519e66585dfc6_200x200_3.png'
		        },
		        values: {
		            key1: 'value1',
		            key2: 'value2'
		        }
		    }
		}, function(ret, err){
		    if( ret ){
//		    	$api.dom('.progress-bar').style.display="block"
//		    	$api.dom('.progress').style.width=ret.progress+"%"
//		    	if(ret.progress===100%){
//		    		$api.dom('.progress-bar').style.display="none"
//		    		alert("上传成功")
//		    	}
		         alert( JSON.stringify( ret ) );   
		    }else{
		         alert( JSON.stringify( err ) );
		    }
		});
    }
   function downloadFile(){
	   	model.downloadFile({
		    report: true,
		    id: '58b6395100207a263e3bede2',
		    savePath: ''
		}, function(ret, err) {
		    if( ret ){
		         alert( JSON.stringify( ret ) );   
		    }else{
		         alert( JSON.stringify( err ) );
		    }
		});
   }
   </script>
   
</html>